<!DOCTYPE html>
<html>
  <head>
    <title>Document Generator</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Anton&family=Source+Sans+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Source Sans Pro", sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: #fff8f3;
        letter-spacing: 0.2px;
      }
      h1 {
        color: #ff6b00;
        text-transform: uppercase;
        margin-bottom: 30px;
        font-family: "Anton", sans-serif;
        letter-spacing: 0.5px;
      }
      .form-group {
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      label {
        width: 150px;
        color: #333;
      }
      .input-group {
        flex: 1;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      input,
      select {
        flex: 1;
        padding: 6px;
        border: 2px solid #ffd0a8;
        border-radius: 4px;
        background: white;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: #ff6b00;
      }
      button {
        background: #ff6b00;
        color: white;
        padding: 8px 16px;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        text-transform: uppercase;
        font-family: inherit;
        letter-spacing: 0.2px;
        transition: background 0.3s;
      }
      .randomize-btn {
        background: #ff8533;
        padding: 6px 12px;
        font-size: 14px;
        transition: background-color 0.3s, transform 0.3s;
      }
      .randomize-btn:hover {
        background: #ff9966;
      }
      .randomize-btn:hover span {
        display: inline-block;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes stripe-animation {
        0% {
          background-position: 0 0;
        }
        100% {
          background-position: 30px 0;
        }
      }
      /* Toggle switch styling */
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #ff6b00;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
      #generateBtn {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        font-size: 18px;
        font-family: "Anton", sans-serif;
        letter-spacing: 0.5px;
      }
      #generateBtn:hover {
        background: repeating-linear-gradient(
          45deg,
          #ff6b00,
          #ff6b00 10px,
          #ff9966 10px,
          #ff9966 20px
        );
        background-size: 30px 30px;
        animation: stripe-animation 1s linear infinite;
      }
      #generateBtn::after {
        content: "‚úß";
        opacity: 0;
        margin-left: 8px;
        transition: opacity 0.3s;
        display: inline-block;
        font-size: 20px;
      }
      #generateBtn:hover::after {
        opacity: 1;
        animation: spin 2s linear infinite;
      }
      #result {
        margin-top: 20px;
        padding: 20px;
        background: white;
        border-radius: 4px;
        border: 2px solid #ffd0a8;
      }
      .download-link {
        color: #ff6b00;
        text-decoration: none;
        display: inline-block;
        margin: 5px 0;
      }
      .download-link:hover {
        color: #ff8533;
      }
    </style>
  </head>
  <body>
    <h1>Document Generator</h1>

    <div class="form-group" id="documentTypeGroup">
      <label>Document Type:</label>
      <div class="input-group">
        <select id="documentType">
          <option value="supplier_invoice">Supplier Invoice</option>
          <option value="pos_receipt">POS Receipt</option>
          <option value="supplier_credit_note">Supplier Credit Note</option>
          <option value="supplier_statement">Supplier Statement</option>
        </select>
      </div>
    </div>

    <div class="form-group" id="dateGroup">
      <label>Date:</label>
      <div class="input-group">
        <input type="text" id="dateField" placeholder="DD/MM/YYYY" />
        <input type="date" id="datePicker" />
      </div>
    </div>

    <div class="form-group" id="supplierNameGroup">
      <label>Supplier Name:</label>
      <div class="input-group">
        <input type="text" id="supplierName" value="Acme Corp" />
        <button
          type="button"
          onclick="randomizeSupplier()"
          class="randomize-btn"
        >
          <span>üé≤</span>
        </button>
      </div>
    </div>

    <div class="form-group" id="customerNameGroup">
      <label>Customer Name:</label>
      <div class="input-group">
        <input type="text" id="customerName" value="Beta LLC" />
        <button
          type="button"
          onclick="randomizeCustomer()"
          class="randomize-btn"
        >
          <span>üé≤</span>
        </button>
      </div>
    </div>

    <div class="form-group" id="documentRefGroup">
      <label>Document Reference:</label>
      <div class="input-group">
        <input type="text" id="documentRef" value="INV-2025-001" />
        <button type="button" onclick="randomizeDocRef()" class="randomize-btn">
          <span>üé≤</span>
        </button>
      </div>
    </div>

    <div class="form-group" id="dueDateGroup">
      <label>Due Date:</label>
      <div class="input-group">
        <input type="text" id="dueField" placeholder="DD/MM/YYYY" />
        <input type="date" id="duePicker" />
      </div>
    </div>

    <div class="form-group" id="currencyGroup">
      <label>Currency:</label>
      <div class="input-group">
        <select id="currency">
          <option value="GBP">GBP</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
        </select>
      </div>
    </div>

    <div class="form-group" id="taxRateGroup">
      <label>Tax Rate (%):</label>
      <div class="input-group">
        <select id="taxRate">
          <option value="5">5%</option>
          <option value="10">10%</option>
          <option value="15">15%</option>
          <option value="20">20%</option>
          <option value="25">25%</option>
        </select>
      </div>
    </div>

    <div class="form-group" id="lineItemsCountGroup">
      <label>Line Items Count:</label>
      <div class="input-group">
        <input type="number" id="lineItemsCount" value="3" min="1" max="10" />
        <button
          type="button"
          onclick="randomizeLineItemsCount()"
          class="randomize-btn"
        >
          <span>üé≤</span>
        </button>
      </div>
    </div>

    <div class="form-group" id="countGroup">
      <label>Count:</label>
      <div class="input-group">
        <select id="count">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
      </div>
    </div>

    <div class="form-group" id="totalAmountGroup">
      <label>Total Amount:</label>
      <div class="input-group">
        <input type="text" id="totalAmount" placeholder="0.00" />
        <button
          type="button"
          onclick="randomizeTotalAmount()"
          class="randomize-btn"
        >
          <span>üé≤</span>
        </button>
      </div>
    </div>

    <div class="form-group" id="linesCountGroup">
      <label>Number of Lines:</label>
      <div class="input-group">
        <input type="number" id="linesCount" value="1" min="1" />
      </div>
    </div>

    <div class="form-group" id="generateInvoicesGroup">
      <label>Generate supporting invoices?</label>
      <div class="input-group">
        <label class="switch"
          ><input type="checkbox" id="generateInvoices" /><span
            class="slider"
          ></span
        ></label>
      </div>
    </div>

    <button onclick="generateDocument()" id="generateBtn">
      Generate Document
    </button>
    <div id="result"></div>
    <div id="spinner" class="spinner" style="display: none"></div>

    <style>
      .spinner {
        margin: 20px auto;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      const supplierNames = [
        "Acme Corp",
        "TechGlobal",
        "MegaCorp",
        "StarSupply",
        "InnovateInc",
      ];
      const customerNames = [
        "Beta LLC",
        "ConsumerCo",
        "ShopMaster",
        "RetailPro",
        "BuyRight",
      ];
      const vis = {
        supplier_invoice: [
          "dateGroup",
          "supplierNameGroup",
          "customerNameGroup",
          "documentRefGroup",
          "dueDateGroup",
          "currencyGroup",
          "taxRateGroup",
          "lineItemsCountGroup",
          "countGroup",
          "totalAmountGroup",
        ],
        pos_receipt: [
          "dateGroup",
          "supplierNameGroup",
          "documentRefGroup",
          "currencyGroup",
          "taxRateGroup",
          "lineItemsCountGroup",
          "countGroup",
          "totalAmountGroup",
        ],
        supplier_credit_note: [
          "dateGroup",
          "supplierNameGroup",
          "documentRefGroup",
          "currencyGroup",
          "taxRateGroup",
          "lineItemsCountGroup",
          "countGroup",
          "totalAmountGroup",
        ],
        supplier_statement: [
          "dateGroup",
          "supplierNameGroup",
          "totalAmountGroup",
          "currencyGroup",
          "linesCountGroup",
          "generateInvoicesGroup",
        ],
      };
      function updateVisibility() {
        const t = document.getElementById("documentType").value;
        const show = vis[t] || [];
        const all = [
          "dateGroup",
          "supplierNameGroup",
          "customerNameGroup",
          "documentRefGroup",
          "dueDateGroup",
          "currencyGroup",
          "taxRateGroup",
          "lineItemsCountGroup",
          "countGroup",
          "totalAmountGroup",
          "linesCountGroup",
          "generateInvoicesGroup",
        ];
        all.forEach(
          (id) =>
            (document.getElementById(id).style.display = show.includes(id)
              ? "flex"
              : "none")
        );
      }
      function getLocale() {
        return document.getElementById("currency").value === "USD"
          ? "US"
          : "UK";
      }
      function formatDate(iso, loc) {
        const [y, m, d] = iso.split("-");
        return loc === "UK" ? `${d}/${m}/${y}` : `${m}/${d}/${y}`;
      }
      let dateISO = "",
        dueISO = "";
      function renderDates() {
        const loc = getLocale();
        document.getElementById("dateField").value = dateISO
          ? formatDate(dateISO, loc)
          : "";
        document.getElementById("dueField").value = dueISO
          ? formatDate(dueISO, loc)
          : "";
      }
      document.addEventListener("DOMContentLoaded", () => {
        updateVisibility();
        renderDates();
        document
          .getElementById("documentType")
          .addEventListener("change", () => {
            updateVisibility();
            renderDates();
          });
        document
          .getElementById("currency")
          .addEventListener("change", renderDates);
        document.getElementById("datePicker").addEventListener("change", () => {
          dateISO = document.getElementById("datePicker").value;
          renderDates();
        });
        document.getElementById("duePicker").addEventListener("change", () => {
          dueISO = document.getElementById("duePicker").value;
          renderDates();
        });
      });
      function randomizeSupplier() {
        document.getElementById("supplierName").value =
          supplierNames[Math.floor(Math.random() * supplierNames.length)];
      }
      function randomizeCustomer() {
        document.getElementById("customerName").value =
          customerNames[Math.floor(Math.random() * customerNames.length)];
      }
      function randomizeDocRef() {
        const pre = document
          .getElementById("documentType")
          .value.substring(0, 3)
          .toUpperCase();
        const y = new Date().getFullYear();
        const r = Math.floor(Math.random() * 10000)
          .toString()
          .padStart(4, "0");
        document.getElementById("documentRef").value = `${pre}-${y}-${r}`;
      }
      function randomizeLineItemsCount() {
        document.getElementById("lineItemsCount").value =
          Math.floor(Math.random() * 8) + 1;
      }
      function randomizeTotalAmount() {
        document.getElementById("totalAmount").value = (
          Math.random() * 9900 +
          100
        ).toFixed(2);
      }

      //validate all required visible fields are filled before sending the request

      function validateForm() {
        const requiredFields = document.querySelectorAll(
          '.form-group:not([style*="display: none"]) input, select'
        );
        for (const field of requiredFields) {
          if (field.value.trim() === "") {
            alert("Please fill in all required fields.");
            field.focus();
            return false;
          }
        }
        return true;
      }

      async function generateDocument() {
        if (!validateForm()) return;

        const generateButton = document.getElementById("generateBtn");
        generateButton.disabled = true;
        generateButton.textContent = "Generating...";

        const documentType = document.getElementById("documentType").value;
        const data = {
          document_type: documentType,
          date: document.getElementById("datePicker").value,
          due_date: document.getElementById("duePicker").value,
          supplier_name: document.getElementById("supplierName").value,
          customer_name: document.getElementById("customerName").value,
          document_ref: document.getElementById("documentRef").value,
          currency: document.getElementById("currency").value,
          tax_rate: parseFloat(document.getElementById("taxRate").value) || 0,
          line_items_count:
            parseInt(document.getElementById("lineItemsCount").value) || 0,
          count: parseInt(document.getElementById("count").value) || 1,
          total_amount:
            parseFloat(document.getElementById("totalAmount").value) || 0,
          number_of_lines:
            parseInt(document.getElementById("linesCount").value) || 0,
          generate_invoices:
            document.getElementById("generateInvoices").checked,
        };

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "";
        document.getElementById("spinner").style.display = "block";

        try {
          const response = await fetch("/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          resultDiv.innerHTML = "";

          if (Array.isArray(result.file)) {
            result.file.forEach((file) => {
              const link = document.createElement("a");
              link.href = file.url;
              link.textContent = `Download ${file.name}`;
              link.target = "_blank";
              link.style.display = "block";
              resultDiv.appendChild(link);
            });
          } else {
            resultDiv.innerHTML = "Unexpected response from server.";
          }
        } catch (error) {
          resultDiv.innerHTML = "‚ö†Ô∏è Error generating document.";
          console.error(error);
        } finally {
          generateButton.disabled = false;
          generateButton.textContent = "Generate";
          document.getElementById("spinner").style.display = "none";
        }
      }
    </script>
  </body>
</html>
